(this["webpackJsonpreact-typescript-starter-pack"]=this["webpackJsonpreact-typescript-starter-pack"]||[]).push([[0],{21:function(e,t,n){},25:function(e,t,n){"use strict";n.r(t);var c=n(4),o=n.n(c),i=(n(19),n(20),n(21),n(1)),a=n.n(i),s=n(8),l=n(2),r=n(3),d=n.n(r);var u,f=n(0),j=a.a.createContext({todos:[],setTodos:function(){},errorMessage:"",setErrorMessage:function(){},newTitle:"",setNewTitle:function(){},selectedId:null,setSelectedId:function(){},isEditing:!1,setIsEditing:function(){},updatedTitle:"",setUpdatedTitle:function(){},isLoading:!1,setIsLoading:function(){},user:null,setUser:function(){}}),m=function(){return a.a.useContext(j)},b=function(e){var t=e.children,n=Object(i.useState)([]),c=Object(l.a)(n,2),o=c[0],a=c[1],s=Object(i.useState)(""),r=Object(l.a)(s,2),d=r[0],u=r[1],m=Object(i.useState)(""),b=Object(l.a)(m,2),p=b[0],h=b[1],O=Object(i.useState)(null),v=Object(l.a)(O,2),g=v[0],x=v[1],y=Object(i.useState)(!1),N=Object(l.a)(y,2),T=N[0],E=N[1],I=Object(i.useState)(""),S=Object(l.a)(I,2),_=S[0],C=S[1],L=Object(i.useState)(!1),k=Object(l.a)(L,2),w=k[0],U=k[1],A=function(e,t){var n=Object(i.useState)((function(){var n=localStorage.getItem(e);if(null===n)return t;try{return JSON.parse(n)}catch(c){return localStorage.removeItem(e),t}})),c=Object(l.a)(n,2),o=c[0],a=c[1];return[o,function(t){localStorage.setItem(e,JSON.stringify(t)),a(t)}]}("user",null),F=Object(l.a)(A,2),M=F[0],D=F[1],P=Object(i.useMemo)((function(){return{todos:o,setTodos:a,errorMessage:d,setErrorMessage:u,newTitle:p,setNewTitle:h,selectedId:g,setSelectedId:x,isEditing:T,setIsEditing:E,updatedTitle:_,setUpdatedTitle:C,isLoading:w,setIsLoading:U,user:M,setUser:D}}),[o,d,p,g,T,_,w,M]);return Object(f.jsx)(j.Provider,{value:P,children:t})};!function(e){e.ALL="All",e.ACTIVE="Active",e.COMPLETED="Completed"}(u||(u={}));var p=function(e){var t=e.currentStatus,n=e.activeTodos,c=e.completedTodos,o=e.setStatus,i=void 0===o?function(){}:o,a=e.onClearCompleted,s=void 0===a?function(){}:a,l=m().isLoading,r=function(e){var t=e.currentTarget.textContent;i(t)};return Object(f.jsxs)("footer",{className:"todoapp__footer","data-cy":"Footer",children:[Object(f.jsx)("span",{className:"todo-count","data-cy":"TodosCounter",children:"".concat(n.length," items left")}),Object(f.jsxs)("nav",{className:"filter","data-cy":"Filter",children:[Object(f.jsx)("a",{href:"#/",className:d()("filter__link",{selected:t===u.ALL}),"data-cy":"FilterLinkAll",onClick:r,children:u.ALL}),Object(f.jsx)("a",{href:"#/active",className:d()("filter__link",{selected:t===u.ACTIVE}),"data-cy":"FilterLinkActive",onClick:r,children:u.ACTIVE}),Object(f.jsx)("a",{href:"#/completed",className:d()("filter__link",{selected:t===u.COMPLETED}),"data-cy":"FilterLinkCompleted",onClick:r,children:u.COMPLETED})]}),Object(f.jsx)("button",{type:"button",className:"todoapp__clear-completed","data-cy":"ClearCompletedButton",onClick:s,disabled:!c.length&&!l,children:"Clear completed"})]})},h=function(e){var t=e.onSubmit,n=e.userId,c=e.isFocused,o=e.toggleAll,a=void 0===o?function(){}:o,s=m(),l=s.todos,r=s.setErrorMessage,u=s.newTitle,j=s.setNewTitle,b=Object(i.useRef)(null),p=l.filter((function(e){return e.completed})).length;Object(i.useEffect)((function(){b.current&&c&&b.current.focus()}),[c]);return Object(f.jsxs)("header",{className:"todoapp__header",children:[l.length>0&&Object(f.jsx)("button",{onClick:function(){return a()},type:"button",className:d()("todoapp__toggle-all",{active:p===l.length}),"data-cy":"ToggleAllButton"}),Object(f.jsx)("form",{onSubmit:function(e){e.preventDefault(),u.trim()?t({id:0,userId:n,title:u.trim(),completed:!1}):r("Title should not be empty")},children:Object(f.jsx)("input",{disabled:!c,ref:b,onChange:function(e){j(e.target.value)},value:u,"data-cy":"NewTodoField",type:"text",className:"todoapp__new-todo",placeholder:"What needs to be done?"})})]})},O=n(28),v=n(27),g=function(e){var t=e.visibleTodos,n=e.onDelete,c=void 0===n?function(){}:n,o=e.tempTodo,a=e.toggleStatus,s=void 0===a?function(){}:a,l=e.onSubmit,r=m(),u=r.selectedId,j=r.setSelectedId,b=r.isEditing,p=r.setIsEditing,h=r.updatedTitle,g=r.setUpdatedTitle,x=r.isLoading,y=Object(i.useRef)(null);Object(i.useEffect)((function(){y.current&&b&&y.current.focus()}),[b]);var N=function(e,t){e.preventDefault(),t.title!==h?l(t):p(!1)},T=function(e){g(e.target.value)},E=function(e){"Escape"===e.key&&p(!1)},I="";h||(I="Empty todo will be deleted");return Object(f.jsx)("section",{className:"todoapp__main","data-cy":"TodoList",children:Object(f.jsxs)(O.a,{children:[t.map((function(e){return Object(f.jsx)(v.a,{timeout:300,classNames:"item",children:Object(f.jsxs)("div",{"data-cy":"Todo",className:d()("todo",{completed:e.completed,active:!e.completed}),children:[Object(f.jsx)("label",{className:"todo__status-label",children:Object(f.jsx)("input",{"data-cy":"TodoStatus",type:"checkbox",className:"todo__status",checked:e.completed,onChange:function(){return s(e)}})}),b&&(null===u||void 0===u?void 0:u.includes(e.id))?Object(f.jsx)("form",{onSubmit:function(t){return N(t,e)},children:Object(f.jsx)("input",{onBlur:function(){return function(e){e.title!==h?l(e):p(!1)}(e)},ref:y,onChange:T,value:h,"data-cy":"TodoTitleField",type:"text",className:"todo__title-field",placeholder:I,onKeyUp:E})}):Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)("span",{"data-cy":"TodoTitle",className:"todo__title",onDoubleClick:function(){return function(e){p(!0),j([e.id]),g(e.title)}(e)},children:e.title}),Object(f.jsx)("button",{type:"button",className:"todo__remove","data-cy":"TodoDelete",onClick:function(){return c(e.id)},children:"\xd7"})]}),Object(f.jsxs)("div",{"data-cy":"TodoLoader",className:d()("modal overlay",{"is-active":(null===u||void 0===u?void 0:u.includes(e.id))&&x}),children:[Object(f.jsx)("div",{className:"modal-background has-background-white-ter"}),Object(f.jsx)("div",{className:"loader"})]})]},e.id)},e.id)})),o&&Object(f.jsx)(v.a,{timeout:300,classNames:"temp-item",children:Object(f.jsxs)("div",{"data-cy":"Todo",className:d()("todo",{completed:o.completed,active:!o.completed}),children:[Object(f.jsx)("label",{className:"todo__status-label",children:Object(f.jsx)("input",{"data-cy":"TodoStatus",type:"checkbox",className:"todo__status",checked:o.completed,readOnly:!0})}),Object(f.jsx)("span",{"data-cy":"TodoTitle",className:"todo__title",children:o.title}),Object(f.jsx)("button",{type:"button",className:"todo__remove","data-cy":"TodoDelete",onClick:function(){return c(o.id)},children:"\xd7"}),Object(f.jsxs)("div",{"data-cy":"TodoLoader",className:d()("modal overlay",{"is-active":x}),children:[Object(f.jsx)("div",{className:"modal-background has-background-white-ter"}),Object(f.jsx)("div",{className:"loader"})]})]},o.id)},0)]})})},x=function(){var e=m(),t=e.errorMessage,n=e.setErrorMessage;return Object(f.jsxs)("div",{"data-cy":"ErrorNotification",className:d()("notification is-danger is-light has-text-weight-normal",{hidden:!t}),children:[Object(f.jsx)("button",{"data-cy":"HideErrorButton",type:"button",className:"delete",onClick:function(){return n("")}}),t]})},y="https://mate.academy/students-api";function N(e){return new Promise((function(t){setTimeout(t,e)}))}function T(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c={method:t};return n&&(c.body=JSON.stringify(n),c.headers={"Content-Type":"application/json; charset=UTF-8"}),N(300).then((function(){return fetch(y+e,c)})).then((function(e){if(!e.ok)throw new Error;return e.json()}))}var E=function(e){return T(e)},I=function(e,t){return T(e,"POST",t)},S=function(e,t){return T(e,"PATCH",t)},_=function(e){return T(e,"DELETE")},C=function(e){return _("/todos/".concat(e))},L=function(e){var t=e.id,n=e.userId,c=e.title,o=e.completed;return S("/todos/".concat(t),{userId:n,title:c,completed:o})},k=function(){var e=m(),t=e.isLoading,n=e.setUser,c=e.setErrorMessage,o=e.setIsLoading,a=Object(i.useState)(""),s=Object(l.a)(a,2),r=s[0],u=s[1],j=Object(i.useState)(""),b=Object(l.a)(j,2),p=b[0],h=b[1],O=Object(i.useState)(!1),v=Object(l.a)(O,2),g=v[0],y=v[1];return Object(f.jsxs)(f.Fragment,{children:[Object(f.jsxs)("form",{className:"box mt-5",onSubmit:function(e){return e.preventDefault(),o(!0),g?function(e){var t=e.name,n=e.username,c=e.email,o=e.phone;return I("/users",{name:t,username:n,email:c,phone:o})}({name:p,username:"",email:r,phone:""}).then((function(e){n(e),y(!1)})).catch((function(){return c("Unable to load todos")})).finally((function(){return o(!1)})):(t=r,E("/users?email=".concat(t))).then((function(e){e[0]?n(e[0]):y(!0)})).catch((function(){c("Unable to load todo")})).finally((function(){return o(!1)}));var t},children:[Object(f.jsx)("h1",{className:"title is-3",children:g?"You need to register":"Log in to open todos"}),Object(f.jsxs)("div",{className:"field",children:[Object(f.jsx)("label",{className:"label",htmlFor:"user-email",children:"Email"}),Object(f.jsxs)("div",{className:"control has-icons-left",children:[Object(f.jsx)("input",{onChange:function(e){u(e.target.value)},className:"input",type:"email",id:"user-email",value:r,placeholder:"Enter your email",required:!0,disabled:g||t}),Object(f.jsx)("span",{className:"icon is-small is-left",children:Object(f.jsx)("i",{className:"fas fa-envelope"})})]})]}),g?Object(f.jsxs)(f.Fragment,{children:[Object(f.jsxs)("div",{className:"field",children:[Object(f.jsx)("label",{className:"label",htmlFor:"user-name",children:"Your Name"}),Object(f.jsxs)("div",{className:"control has-icons-left",children:[Object(f.jsx)("input",{type:"text",id:"user-id",className:"input",placeholder:"Enter your name",required:!0,minLength:4,value:p,onChange:function(e){h(e.target.value)},disabled:t}),Object(f.jsx)("span",{className:"icon is-small is-left",children:Object(f.jsx)("i",{className:"fas fa-user"})})]})]}),Object(f.jsx)("div",{className:"field",children:Object(f.jsx)("button",{type:"submit",className:d()("button is-primary",{"is-loading":t}),children:"Register"})})]}):Object(f.jsx)("div",{className:"field",children:Object(f.jsx)("button",{type:"submit",className:d()("button is-primary",{"is-loading":t}),children:"Login"})})]}),Object(f.jsx)(x,{})]})};var w=function(){var e=m(),t=e.todos,n=e.setTodos,c=e.errorMessage,o=e.setErrorMessage,a=e.setNewTitle,r=e.setSelectedId,d=e.setIsEditing,j=e.updatedTitle,b=e.setIsLoading,O=e.isLoading,v=e.user,y=Object(i.useState)(u.ALL),N=Object(l.a)(y,2),T=N[0],S=N[1],_=Object(i.useState)(null),w=Object(l.a)(_,2),U=w[0],A=w[1],F=function(e,t){switch(t){case u.ACTIVE:return e.filter((function(e){return!e.completed}));case u.COMPLETED:return e.filter((function(e){return e.completed}));default:return e}}(t,T),M=Object(i.useState)(!0),D=Object(l.a)(M,2),P=D[0],B=D[1],J=t.filter((function(e){return e.completed})),V=t.filter((function(e){return!e.completed})),R=J.map((function(e){return e.id})),q=function(){c&&setTimeout((function(){o("")}),3e3)};Object(i.useEffect)(q,[c]),Object(i.useEffect)((function(){var e;v&&(e=v.id,E("/todos?userId=".concat(e))).then((function(e){n(e)})).catch((function(){o("Unable to load todos")}))}),[v]);return v?Object(f.jsxs)("div",{className:"todoapp",children:[Object(f.jsx)("h1",{className:"todoapp__title",children:"todos"}),Object(f.jsxs)("div",{className:"todoapp__content",children:[Object(f.jsx)(h,{isFocused:P,userId:v.id,onSubmit:function(e){var c=e.userId,i=e.title,l=e.completed;b(!0),B(!1);var r=function(e){var t=e.userId,n=e.title,c=e.completed;return I("/todos",{userId:t,title:n,completed:c})}({userId:c,title:i.trim(),completed:l}).then((function(e){n([].concat(Object(s.a)(t),[e])),a("")})).catch((function(){o("Unable to add a todo"),q()})).finally((function(){b(!1),A(null),B(!0)}));return v&&A({id:0,userId:v.id,title:i,completed:l}),r},toggleAll:function(){b(!0);var e=t.filter((function(e){return!e.completed})),c=Object(s.a)(t);e.length>0&&(c=e);var i=c.map((function(e){return e.id}));return r(i),Promise.all(c.map((function(e){var t=e.id,n=e.userId,c=e.title,o=e.completed;return L({id:t,userId:n,title:c,completed:!o})}))).then((function(e){var c=Object(s.a)(t);e.forEach((function(e){var t=c.findIndex((function(t){return t.id===e.id}));c.splice(t,1,e)})),n(c)})).catch((function(){o("Unable to update a todo")})).finally((function(){b(!1),r(null)}))}}),F&&Object(f.jsx)(g,{tempTodo:U,visibleTodos:F,onDelete:function(e){return b(!0),r([e]),B(!1),C(e).then((function(){n(t.filter((function(t){return t.id!==e})))})).catch((function(){o("Unable to delete a todo")})).finally((function(){b(!1),r(null),B(!0)}))},toggleStatus:function(e){var c=e.id,i=e.userId,a=e.title,l=e.completed;return r([c]),b(!0),L({id:c,userId:i,title:a,completed:!l}).then((function(e){var o=Object(s.a)(t),i=o.findIndex((function(e){return e.id===c}));o.splice(i,1,e),n(o)})).catch((function(){o("Unable to update a todo")})).finally((function(){r(null),b(!1)}))},onSubmit:function(e){var c=e.id,i=e.userId,a=e.completed;if(j.trim())r([c]),b(!0),L({id:c,userId:i,title:j.trim(),completed:a}).then((function(e){var o=Object(s.a)(t),i=o.findIndex((function(e){return e.id===c}));o.splice(i,1,e),n(o),r(null),d(!1)})).catch((function(){b(!1),o("Unable to update a todo"),b(!1)})).finally((function(){b(!1)}));else{if(O)return;!function(e){b(!0),r([e]),B(!1),C(e).then((function(){n(t.filter((function(t){return t.id!==e}))),r(null),B(!1)})).catch((function(){o("Unable to delete a todo")})).finally((function(){b(!1)}))}(c)}}}),(t.length>0||U)&&Object(f.jsx)(p,{setStatus:S,currentStatus:T,onClearCompleted:function(){return b(!0),B(!1),r(R),Promise.allSettled(R.map((function(e){return C(e)}))).then((function(e){var c=[];R.forEach((function(i,a){"fulfilled"===e[a].status&&c.push(i),"rejected"===e[a].status&&o("Unable to delete a todo");var s=t.filter((function(e){return!c.includes(e.id)}));n(s)}))})).catch((function(){o("Unable to delete a todo")})).finally((function(){b(!1),r(null),B(!0)}))},completedTodos:J,activeTodos:V})]}),Object(f.jsx)(x,{})]}):Object(f.jsx)(k,{})},U=function(){return Object(f.jsx)(b,{children:Object(f.jsx)(w,{})})};o.a.render(Object(f.jsx)(U,{}),document.getElementById("root"))}},[[25,1,2]]]);
//# sourceMappingURL=main.da31d013.chunk.js.map